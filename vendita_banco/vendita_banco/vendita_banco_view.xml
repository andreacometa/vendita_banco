<?xml version="1.0"?>
<openerp>
    <data>

		<!--========================================================-->
		<!--					VENDITA BANCO - TREE				-->
		<!--========================================================-->
		<record model="ir.ui.view" id="view_vendita_banco_tree">
			<field name="name">vendita_banco.tree</field>
			<field name="model">vendita_banco</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Vendite" colors="blue:state=='draft';orange:invoice_id != False;orange:vb_raggruppamento_id != False">
					<field name="causale" />
					<field name="name"/>
					<field name="data_ordine"/>
					<field name="partner_id" />
					<field name="imponibile" sum="Totale Imponibile"/>
					<field name="totale" sum="Totale"/>
					<field name="invoice_id" invisible="1" />
					<field name="vb_raggruppamento_id" invisible="1" />
					<field name="state" />
					<field name="user_id" invisible="1"/>
				</tree>
			</field>
		</record>
		
		<!--========================================================-->
		<!--					VENDITA BANCO - FORM				-->
		<!--========================================================-->
		<record model="ir.ui.view" id="view_vendita_banco_form">
			<field name="name">vendita_banco.form</field>
			<field name="model">vendita_banco</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Vendita Banco">
					<group col="6" colspan="4">
						<field name="name" readonly="1"/>
						<field name="data_ordine" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}"/>
						<field name="causale" on_change="onchange_causale(causale)"
							attrs="{'readonly':['|', ('state','in',['done', 'invoiced']), ('name', '!=', False)]}" />
						<field name="ddt" invisible="1" />
					</group>
					<group col="6" colspan="4">
						<field name="partner_id" on_change="onchange_cliente_id(partner_id, causale)"
							attrs="{'readonly':[('state','in',['done', 'invoiced'])]}" domain="[('customer', '=', True)]"/>
						<field name="partner_invoice_id" domain="[('partner_id', '=', partner_id)]" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="partner_shipping_id" domain="[('partner_id', '=', partner_id)]" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}" />
					</group>
					<group col="4" colspan="4">
						<field name="pricelist_id" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="modalita_pagamento_id" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}" />
							<!--on_change="onchange_modalita_pagamento(modalita_pagamento_id)"/-->
					</group>
					<group col="8" colspan="4">
						<field name="goods_description_id" attrs="{'required':[('ddt','=',True)], 'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}"/>
						<field name="carriage_condition_id" attrs="{'required':[('ddt','=',True)], 'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="transportation_reason_id" attrs="{'required':[('ddt','=',True)], 'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="data_inizio_trasporto" attrs="{'required':[('ddt','=',True)], 'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}" />
					</group>
					<group col="6" colspan="4">
						<field name="number_of_packages" attrs="{'required':[('ddt','=',True)], 'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="tipo_trasporto_id" attrs="{'required':[('ddt','=',True)], 'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="trasportatore_id" attrs="{'invisible':[('ddt','=',False)], 'readonly':[('state','in',['done', 'invoiced'])]}" />
					</group>
					<notebook colspan="4">
						<page string="Vendita">
							<field colspan="4" mode="tree,form,graph" name="vendita_banco_dettaglio_ids" nolabel="1" widget="one2many_list" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}">
								<form string="Dettagli">
									<group colspan="4" col="6">
										<field name="product_id" colspan="4"
											on_change="onchange_product(product_id, product_qty, parent.data_ordine, parent.partner_id, parent.pricelist_id, tax_id)"/>
										<field name="spesa" colspan="2"/>
									</group>
									<field name="name"/>
									<field name="product_qty"/>
									<field name="product_uom"/>
									<field name="price_unit" groups="vendita_banco.group_vendita_banco_management"/>
									<field name="discount"/>
									<field name="tax_id"/>
									<field name="imponibile"  groups="vendita_banco.group_vendita_banco_management"/>
									<field name="importo"  groups="vendita_banco.group_vendita_banco_management"/>
                                    <separator string="Note" />
                                    <field name="note" colspan="4" nolabel="1" />
								</form>
								<tree string="Dettagli" editable="top">
                                    <field name="sequence" widget="handle"/>
									<field name="product_id" on_change="onchange_product(product_id, product_qty, parent.data_ordine, parent.partner_id, parent.pricelist_id, tax_id)"/>
									<field name="name" />
									<field name="product_qty" sum="Quantità"/>
									<field name="product_uom"/>
									<field name="price_unit" groups="vendita_banco.group_vendita_banco_management"/>
									<field name="discount"/>
									<field name="tax_id"/>
									<field name="importo" sum="Importo" groups="vendita_banco.group_vendita_banco_management"/>
									<field name="imponibile" sum="Imponibile" groups="vendita_banco.group_vendita_banco_management"/>
								</tree>
							</field>
						</page>
						<page string="Altro">
                                <group>
                                    <group>
                                        <field name="invoice_id" />
                                        <field name="move_id" />
                                    </group>
									<group>
                                        <field name="vb_raggruppamento_id" />
                                        <field name="picking_id" />
                                    </group>
                                    <group>
                                        <field name="note" colspan="4"/>
                                    </group>
                                    <separator string="Numerazione"
                                               groups="account.group_account_manager"/>
                                    <field name="internal_number"
                                           groups="account.group_account_manager"
                                           attrs="{'readonly':[('state','in',['done', 'invoiced'])]}"/>
                                </group>
						</page>
					</notebook>
					<group col="10" colspan="4">
						<field name="acconto" attrs="{'readonly':[('state','in',['done', 'invoiced'])]}" />
						<field name="imponibile" />
						<field name="totale" />
						<field name="state" />
						<group col="4" colspan="1">
							<button name="conferma_vendita" type="object" states="draft" string="Conferma" icon="gtk-apply"/>
							<button name="riapri_vendita" type="object" states="done,invoiced,validated" string="Riapri Vendita" icon="gtk-cancel"/>
							<button name="create_so_invoice" type="object"
								attrs="{'invisible':['|', ('fatturabile','=',False), ('state', 'in', ['draft', 'invoiced'] )]}" string="Crea Fattura" icon="terp-dolar_ok!"/>
							<button name="stampa" type="object"
								attrs="{'invisible':['|', ('report','=',False),('state','=','draft')]}" string="Stampa" icon="gtk-print"
								groups="vendita_banco.group_vendita_banco_printer"/>
						</group>
						<field name="fatturabile" invisible="1" />
						<field name="report" invisible="1"/>
						<field name="company_id" invisible="1"/>
					</group>
				</form>
			</field>
		</record>

		<!-- ====================================================== -->
		<!-- 					VENDITA BANCO - FILTRI 				-->
		<!-- ====================================================== -->
        <record id="vendita_banco_filtri" model="ir.ui.view">
            <field name="name">vendita_banco.filtri</field>
            <field name="model">vendita_banco</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Filtri Vendita Banco">
                    <filter name="non_confermati" icon="terp-document-new" string="Non Confermati" domain="[('state','=','draft')]" help="Preventivi"/>
                    <filter name="confermati" icon="terp-check" string="Confermati" domain="[('state','in',['done', 'invoiced'])]" help="BC Confermati"/>
                    <!--filter icon="terp-check" string="DDT" domain="[('ddt','=',True)]" help="DDT Confermati"/-->
                    <filter name="non_fatturati" icon="terp-dolar_ok!" string="Fatturati" domain="[('state','=','invoiced')]" help="Fatturati"/>
                    <filter name="fatturati" icon="terp-dolar_ok!" string="Non Fatturati" domain="[('state','!=','invoiced')]" help="Non Fatturati"/>
                    <separator orientation="vertical"/>
                    <field name="name" select="1"/>
                    <field name="data_ordine" />
                    <field name="partner_id" />
                    <field name="causale" />
                    <separator orientation="vertical"/>
                    <field name="user_id"/>
                    <newline/>
               </search>
            </field>
        </record>

		<!-- ====================================================== -->
		<!-- 					VENDITA BANCO - ACTION 				-->
		<!-- ====================================================== -->
		<record model="ir.actions.act_window" id="action_vendita_banco">
				<field name="name">Vendita Banco</field>
				<field name="type">ir.actions.act_window</field>
				<field name="res_model">vendita_banco</field>
				<field name="view_type">form</field>
				<field name="view_mode">tree,form</field>
				<field name="view_id" ref="view_vendita_banco_tree"/>
				<field name="search_view_id" ref="vendita_banco_filtri"/>
		</record>
		
		
		<!--========================================================-->
		<!--			VENDITA BANCO DETTAGLIO - FORM				-->
		<!--========================================================-->
		<record id="view_vendita_banco_dettaglio_form" model="ir.ui.view">
			<field name="name">vendita.banco.dettaglio.form</field>
			<field name="model">vendita_banco.dettaglio</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Dettagli Vendite">
					<group col="6" colspan="4">
						<field name="causale"/>
						<field name="vendita_banco_id"/>
						<field name="partner_id"/>
					</group>
					<field name="name" colspan="4"/>
					<field name="product_id" colspan="2"/>
					<field name="product_qty" colspan="2"/>
					<field name="price_unit" colspan="2"/>
					<field name="importo" colspan="2"/>
					<field name="imponibile" colspan="2"/>
				</form>
			</field>
		</record>
		
		<!--========================================================-->
		<!--			VENDITA BANCO DETTAGLIO - TREE				-->
		<!--========================================================-->
		<record id="view_vendita_banco_dettaglio_tree" model="ir.ui.view">
			<field name="name">vendita.banco.dettaglio.tree</field>
			<field name="model">vendita_banco.dettaglio</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Dettagli Vendite">
					<field name="causale"/>
					<field name="vendita_banco_id"/>
					<field name="data_ordine"/>
					<field name="partner_id"/>
					<field name="name"/>
					<field name="product_id"/>
					<field name="product_qty" sum="Quantità"/>
					<field name="price_unit"/>
					<field name="importo" sum="Importo"/>
					<field name="imponibile" sum="Impnibile"/>
				</tree>
			</field>
		</record>
		
		<!-- ====================================================== -->
		<!-- 					VENDITA BANCO - FILTRI 				-->
		<!-- ====================================================== -->
		<record id="vendita_banco_dettaglio_filtri" model="ir.ui.view">
			<field name="name">vendita_banco.dettaglio.filtri</field>
			<field name="model">vendita_banco.dettaglio</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Filtri Dettaglio Vendita">
					<field name="causale" filter_domain="['|', ('causale.name','ilike',self),('causale.descrizione','ilike',self)]"/>
					<field name="vendita_banco_id"/>
					<field name="data_ordine"/>
					<field name="partner_id" filter_domain="['|', ('partner_id.name','ilike',self),('partner_id.ref','ilike',self)]"/>
					<field name="product_id" /> <!--filter_domain="['|', ('product_id.name','ilike',self),('product_id.default_code','ilike',self)]"/-->
					<newline/>
			   </search>
			</field>
		</record>
		
		<!-- ====================================================== -->
		<!-- 			VENDITA BANCO DETTAGLIO - ACTION 			-->
		<!-- ====================================================== -->
		<record model="ir.actions.act_window" id="action_vendita_banco_dettaglio">
				<field name="name">Vendita Banco Dettaglio</field>
				<field name="type">ir.actions.act_window</field>
				<field name="res_model">vendita_banco.dettaglio</field>
				<field name="view_type">form</field>
				<field name="view_mode">tree,form</field>
				<field name="view_id" ref="view_vendita_banco_dettaglio_tree"/>
				<field name="search_view_id" ref="vendita_banco_dettaglio_filtri"/>
				<field name="context">{'form_view_ref' : 'vendita_banco.view_vendita_banco_dettaglio_form'}</field>
		</record>
		
		<record id="view_vendita_banco_tipo_trasporto_tree" model="ir.ui.view">
			<field name="name">vendita_banco.trasporto.tree</field>
			<field name="model">vendita_banco.trasporto</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Tipo Trasporto" editable="top">
					<field name="name" required="1"/>
				</tree>
			</field>
		</record>
		
		<!-- ====================================================== -->
		<!-- 				TIPO TRASPORTO - ACTION 				-->
		<!-- ====================================================== -->
		<record model="ir.actions.act_window" id="action_vendita_banco_tipo_trasporto">
				<field name="name">Tipo Trasporto</field>
				<field name="type">ir.actions.act_window</field>
				<field name="res_model">vendita_banco.trasporto</field>
				<field name="view_type">form</field>
				<field name="view_mode">tree,form</field>
				<field name="view_id" ref="view_vendita_banco_tipo_trasporto_tree"/>
		</record>
		
		<!-- ====================================================== -->
		<!-- 					VENDITA BANCO - MENU 				-->
		<!-- ====================================================== -->
		<menuitem icon="terp-partner" id="menu_vendita_banco_main" name="Vendita al Banco" web_icon="static/vendita.png" web_icon_hover="static/vendita-hover.png" groups="vendita_banco.group_vendita_banco,vendita_banco.group_vendita_banco_management"/>
			<!-- VENDITA BANCO -->
			<menuitem icon="STOCK_OPEN" parent="menu_vendita_banco_main" id="menu_vendita_banco" name="Vendita al Banco"/>
				<menuitem action="action_vendita_banco" parent="menu_vendita_banco" id="menu_vendita_banco_vendita" name="Vendita al Banco" sequence="1"/>
				<menuitem action="action_vendita_banco_dettaglio" parent="menu_vendita_banco" id="menu_vendita_banco_dettaglio" name="Dettagli Vendite" sequence="2"/>
			<!-- PARTNER -->
			<menuitem icon="terp-partner" parent="menu_vendita_banco_main" id="menu_vendita_banco_partner" name="Partner" sequence="10"/>
				<menuitem action="base.action_partner_customer_form" parent="menu_vendita_banco_partner" id="menu_vendita_banco_customer" name="Clienti" sequence="1"/>
				<menuitem action="base.action_partner_supplier_form" parent="menu_vendita_banco_partner" id="menu_vendita_banco_supplier" name="Fornitori" sequence="2"/>
                <menuitem action="base.action_partner_address_form" id="menu_partner_address_form" name="Contacts" parent="menu_vendita_banco_partner" sequence="30"/>

			<!-- CONFIGURAZIONI -->
			<menuitem icon="terp-tools" groups="base.group_extended" parent="menu_vendita_banco_main"
				id="menu_vendita_banco_config" name="Configurazioni" sequence="20"/>
				<menuitem action="action_vendita_banco_tipo_trasporto" parent="menu_vendita_banco_config" id="menu_vendita_banco_config_tipo_trasporto" name="Tipo Trasporto" sequence="2"/>
				<menuitem parent="menu_vendita_banco_config" id="product.menu_product_pricelist_main" name="Listini" sequence="3"/>
			<!-- EXTRA -->
			<menuitem icon="terp-tools" groups="base.group_extended" parent="menu_vendita_banco_main"
				id="menu_vendita_banco_extra" name="Extra" sequence="30"/>


		<!-- ====================================================== -->
		<!-- 		VENDITA BANCO DETTAGLIO DA PRODUCT- ACTION 		-->
		<!-- ====================================================== -->
		<act_window
			context="{'search_default_product_id': [active_id], 'default_product_id': active_id}"
			id="action_vendita_banco_dettaglio_product_tree"
			name="Movimenti Vendita"
			res_model="vendita_banco.dettaglio"
			src_model="product.product"/>

		<record id="dp_vendita_banco_dettaglio" model="decimal.precision">
			<field name="name">Vendita Banco Dettaglio</field>
			<field name="digits">4</field>
		</record>

	</data>
</openerp>
